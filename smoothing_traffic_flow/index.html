
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Yanzhi Yao, Anish Kulkarni, Yang Zheng" name="author"/>
<link href=".." rel="prev"/>
<link href="../structured_optimal_control/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.6" name="generator"/>
<title>Smoothing Traffic Flow - Mixed Traffic Control</title>
<link href="../assets/stylesheets/main.ded33207.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#smoothing-traffic-flow">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Mixed Traffic Control" class="md-header__button md-logo" data-md-component="logo" href=".." title="Mixed Traffic Control">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Mixed Traffic Control
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Smoothing Traffic Flow
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/soc-ucsd/mixed-traffic" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    soc-ucsd/mixed-traffic
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
      Welcome
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="./">
      Smoothing Traffic Flow
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../structured_optimal_control/">
      Structured Optimal Control
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../cooperative_formation_multiple/">
      Cooperative Formation Multiple CAVs
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../student_project/numerical_data/">
        Student Project
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../deepLCC/">
      DeepLCC
    </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Mixed Traffic Control" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Mixed Traffic Control">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Mixed Traffic Control
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/soc-ucsd/mixed-traffic" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    soc-ucsd/mixed-traffic
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Welcome
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Smoothing Traffic Flow
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Smoothing Traffic Flow
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#introduction">
    Introduction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#basis-theories">
    Basis Theories
  </a>
<nav aria-label="Basis Theories" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-establishment-schematic">
    Model Establishment Schematic
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scenario-autonomous-vehicle-increases-traffic-speed">
    Scenario: Autonomous Vehicle Increases Traffic Speed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#impulse-perturbation">
    Impulse Perturbation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stablizing-traffic-flows">
    Stablizing Traffic Flows
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-started">
    Getting Started
  </a>
<nav aria-label="Getting Started" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#environment-setup">
    Environment Setup
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#matlab-implementation">
    Matlab Implementation
  </a>
<nav aria-label="Matlab Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#main-file">
    Main File
  </a>
<nav aria-label="Main File" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#demo_smoothing-traffic_flowm">
    demo_smoothing traffic_flow.m
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#functions">
    Functions
  </a>
<nav aria-label="Functions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#lqr_sdpm">
    lqr_sdp.m
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ring_traffic_modelm">
    ring_traffic_model.m
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python-implementation">
    Python Implementation
  </a>
<nav aria-label="Python Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#functions_1">
    Functions
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#experiment-results">
    Experiment Results
  </a>
<nav aria-label="Experiment Results" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#animation">
    Animation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#control-energy-results">
    Control Energy Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#velocity-numerical-results">
    Velocity Numerical Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#maximum-spacing-results">
    Maximum Spacing Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fuel-consumption-results">
    Fuel Consumption Results
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reference">
    Reference
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../structured_optimal_control/">
        Structured Optimal Control
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cooperative_formation_multiple/">
        Cooperative Formation Multiple CAVs
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Student Project
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Student Project
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../student_project/numerical_data/">
        Penetration Rate Experiments
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../deepLCC/">
        DeepLCC
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="smoothing-traffic-flow">Smoothing Traffic Flow<a class="headerlink" href="#smoothing-traffic-flow" title="Permanent link">¶</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>Autonomous vehicle is essential for control the traffic flow and would have higher potential if number of autonomous vehicles increases. From our analysis, 5% proportion of autonomous vehicles would be able to increase the traffic speed by more than 6%. This is very possible nowadays, and with more autonomous vehicles on highway the average speed will keep raising. We proved this by using control theorem framework and considered each autonomous vehicles as controllable nodes. We analysis controllability and stability of the system and designed a control strategy for autonomous vehicles to achieve the ability to smooth mixed traffic flow. In testing, we designed a ring road, for convenience, with mixed traffic driving inside, using the control strategy and get the analytical results on controllability, stability, and reachability. </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/mixed_traffic_flow_schematic%20diagram.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/mixed_traffic_flow_schematic%20diagram.png"/></a></p>
<h2 id="basis-theories">Basis Theories<a class="headerlink" href="#basis-theories" title="Permanent link">¶</a></h2>
<h3 id="model-establishment-schematic">Model Establishment Schematic<a class="headerlink" href="#model-establishment-schematic" title="Permanent link">¶</a></h3>
<p>We use blue car and dot to represent the autonomous vehicles, and green cars and dots to represent human driven vehicles. The first figure in the left hand side is the ring road traffic scenario, the second images represent the simplified system schematic. We have purple arrows indicate the interaction between adjacent vehicles. Orange arrows show information flow of the entire system. On the right hand side is the System matrix A of the entire mixed traffic dynamics. </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/Model_establishment_schematic.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/Model_establishment_schematic.png"/></a></p>
<h3 id="scenario-autonomous-vehicle-increases-traffic-speed">Scenario: Autonomous Vehicle Increases Traffic Speed<a class="headerlink" href="#scenario-autonomous-vehicle-increases-traffic-speed" title="Permanent link">¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/Traffic_scenario.png"><img align="right" alt="Alt Text" src="../images/smoothing_traffic_flow/Traffic_scenario.png"/></a></p>
<p>The scenario that autonomous vehicle increases the traffic speed. 
(a) Is the scenario that all vehicles are human driven and the space between each two vehicles is equal for homogeneous car following dynamics. 
(b) Is the case of mixed traffic systems. The Autonomous vehicle can follow the front car in a short distance. As a result, the rear vehicle will have a larger space and equilibrium velocity increases as the distance increase. Hence, the entire traffic flow speed increase after adding one autonomous vehicle. </p>
<h3 id="impulse-perturbation">Impulse Perturbation<a class="headerlink" href="#impulse-perturbation" title="Permanent link">¶</a></h3>
<p>The graphs below represent impulse perturbation in traffic systems on a ring road. The second vehicle has initial perturbation. </p>
<ul>
<li>(a) All vehicles are human driven. </li>
<li>(b) The first vehicle is CACC equipped which could adjusts behavior passively due to its direct preceding vehicle. </li>
<li>(c)The first vehicle has optimal control strategy which can consider the global behavior of the entire mixed traffic flow. </li>
</ul>
<p>By checking of these three graphs, it is obvious that the system with optimal control strategy which could consider global behavior have the best performance. </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/Velocity_deviation.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/Velocity_deviation.png"/></a></p>
<h3 id="stablizing-traffic-flows">Stablizing Traffic Flows<a class="headerlink" href="#stablizing-traffic-flows" title="Permanent link">¶</a></h3>
<ul>
<li>(a) Traffic system with Human driven vehicles only is unstable in certain case.</li>
<li>(b) The mixed traffic system becomes stable after introducing one autonomous vehicle with assigned control strategy.</li>
<li>(c) The traffic flow with one autonomous vehicle could guide the traffic to a higher stable velocity via controlling the autonomous vehicle. </li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/stablizing_traffic_flow.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/stablizing_traffic_flow.png"/></a></p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">¶</a></h2>
<h3 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">¶</a></h3>
<p>To run the code, the Modeling package, <a href="https://yalmip.github.io/">YALMIP</a>, and the optimization solver, <a href="https://www.mosek.com/">MOSEK</a>, are needed to solve the semidefinite program in controller synthesis.</p>
<p>YALMIP:</p>
<p>Please install YALMIP using the provided link. Follow the Tutorial in the YALMIP website and download the YALMIP file. Once you obtained the YALMIP folder. We can put the whole YALMIP folder into our project folder.</p>
<p>MOSEK:</p>
<p>Please follow the installation instruction in MOSEK website to install MOSEK on your machine. <strong> Please remember to apply a license from the MOSEK website. After obtaining the license, you can put it in your project folder and your system document MOSEK path.</strong> The path is different depends on your system.</p>
<h2 id="matlab-implementation">Matlab Implementation<a class="headerlink" href="#matlab-implementation" title="Permanent link">¶</a></h2>
<h4 id="main-file">Main File<a class="headerlink" href="#main-file" title="Permanent link">¶</a></h4>
<h5 id="demo_smoothing-traffic_flowm"><a href="https://github.com/soc-ucsd/mixed-traffic/blob/main/smoothing_traffic_flow_via_AVs/demo_smoothing_traffic_flow.m">demo_smoothing traffic_flow.m</a><a class="headerlink" href="#demo_smoothing-traffic_flowm" title="Permanent link">¶</a></h5>
<p>Add path and initialization
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nb">clc</span><span class="p">;</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nb">clear</span><span class="p">;</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="nb">addpath</span><span class="p">(</span><span class="s">'_fcn'</span><span class="p">);</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="nb">addpath</span><span class="p">(</span><span class="s">'_data'</span><span class="p">);</span>
</code></pre></div></p>
<p>Key parameters setting:</p>
<p>'mix' is set to 0 by default, which means there's no AV. While 'mix = 1' means the mixed traffic scenario. 'controllerType' set the control strategies for mixed traffic control. </p>
<p>'controllerType' value to strategies:</p>
<ul>
<li>1.Optimal Control  </li>
<li>2.FollowerStopper </li>
<li>3.PI with Saturation</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">mix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">controllerType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>brakeID indicate the index of vehicle that will brake first (interuption happen). N indicate the total number of vehicle in the experiment. s_star means the  equilibrium spacing of each vehicle.</p>
<p><div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">brakeID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">s_star</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</code></pre></div>
ControllerType parameter setting:</p>
<ul>
<li>gamma_s means the preference setting of vehicle spacing.</li>
<li>gamma_v means the preference setting of vehicle velocity.</li>
<li>gamma_u means the preference setting of vehicle input.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">if</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">controllerType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="c">%Cost Function Weight</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="n">gammaType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="n">gammaType</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">            </span><span class="n">gamma_s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.03</span><span class="p">;</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">            </span><span class="n">gamma_v</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.15</span><span class="p">;</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">            </span><span class="n">gamma_u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">            </span><span class="n">gamma_s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">            </span><span class="n">gamma_v</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">            </span><span class="n">gamma_u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="n">K</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">lqr_sdp</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">s_star</span><span class="p">,</span><span class="n">gamma_s</span><span class="p">,</span><span class="n">gamma_v</span><span class="p">,</span><span class="n">gamma_u</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="k">end</span>
</code></pre></div>
<p>alpha_k setting is only for FollowerStopper strategy.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">alpha_k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6</span><span class="p">;</span>
</code></pre></div>
Animation setting:</p>
<ul>
<li>velUpperBound means the upper bound of vehicle speed. It was set to 15 m/s. Corresponding to the green color for Animation. </li>
<li>velLowerBound indicate the lower bound of vehicle speend. It was set to 8 m/s. Corresponding to the red color for Animation.</li>
<li>vehicle size was set to 12 by default. 
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">velUpperBound</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w"> </span><span class="c">% color</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">velLowerBound</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c">% color</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">vehicleSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w"> </span><span class="c">% MarkerSize</span>
</code></pre></div></li>
</ul>
<p>Vehicle parameters setting:</p>
<ul>
<li>v_max indicate the maximum velocity the vehicle can reach. acel_max and decel_max indicate the maximum acceleration and amximun deacceleration rate respectively. The Driver model is set by using OVM model.</li>
<li>acel_max and dcel_max indicate the maximum acceleration rate and mininmum acceleration rate.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">v_max</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">acel_max</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="n">dcel_max</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="p">;</span>
</code></pre></div></li>
</ul>
<p>OVM Model setting:</p>
<ul>
<li>
<p>alpha and beta was set to 0.6 and 0.9. Where alpha &gt; 0 reflects the driver’s sensitivity to the difference between the current velocity and the spacing-dependent
desired velocity V (si(t)), and beta &gt; 0 reflects the driver’s
sensitivity to the difference between the velocities of the front vehicle and the preceding vehicle</p>
</li>
<li>
<p>s_st, s_go indicate the spacing between vehicles that the velocity state change. When the spacing is smaller than space st. The vehicle speed will come down to zero. When the spacing is lareger
than s_go(spacing for go). The vehicle will achieve the maximum velocity.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nb">alpha</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6</span><span class="p">;</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nb">beta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.9</span><span class="p">;</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">s_st</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">s_go</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">35</span><span class="p">;</span>
</code></pre></div></p>
</li>
</ul>
<p>Simulation setting:</p>
<ul>
<li>TotalTime definite the end time (100s) of the simulations.</li>
<li>
<p>NumStep is calculated by TotalTime/Tstep
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="n">TotalTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">Tstep</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="n">NumStep</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TotalTime</span><span class="o">/</span><span class="n">Tstep</span><span class="p">;</span>
</code></pre></div></p>
</li>
<li>
<p>The Circumference indicate the ring circumference for the simulation. It is calculated bse on the value of the vehicle number N and equilibrium spacing s_star.</p>
</li>
<li>The actuation setting set the time when the controller will be engaged.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">Circumference</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">s_star</span><span class="o">*</span><span class="n">N</span><span class="p">;</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="k">if</span><span class="w"> </span><span class="n">mix</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="n">ActuationTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c">%When will the controller work</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="k">else</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">    </span><span class="n">ActuationTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">9999</span><span class="p">;</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="k">end</span>
</code></pre></div>
<p>Equilibrium state setting:</p>
<ul>
<li>v_star indicate the theoretically equilibrium velocity.</li>
<li>s_ctr indicate the desire controller spacing which is set equal to the equilibrium spacing. </li>
<li>v_ctr indicate the monotonically increasing function that the controller apply according to the spacing informations.(st &lt; s &lt; sgo).
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">s_star</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Circumference</span><span class="o">/</span><span class="n">N</span><span class="p">;</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">v_star</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v_max</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">s_star</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">)));</span><span class="w"> </span><span class="c">%THEORETICALLY equilibrium velocity</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="n">s_ctr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">s_star</span><span class="o">*</span><span class="mf">1.0</span><span class="p">;</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">v_ctr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v_max</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">s_ctr</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">)));</span>
</code></pre></div></li>
</ul>
<p>Safe distance setting:</p>
<p>The minimum safe distance value is set to zero since the vehicle length is ignored.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">sd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</code></pre></div></p>
<p>Initial State for each vehicle:</p>
<p>_ dev_s indicate the deviation spacing for each vehicle.
- dev_v means the deviation velocity.
- v_ini indicate the initial velocity of each vehicle.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">S</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">NumStep</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">dev_s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">dev_v</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="n">co_v</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="n">v_ini</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">co_v</span><span class="o">*</span><span class="n">v_star</span><span class="p">;</span><span class="w"> </span><span class="c">%Initial velocity</span>
</code></pre></div></p>
<p>Theorectical part for the simulation:</p>
<p>Here is to determine if there are sufficient condition for the mixed traffic control simulation. And show some important parameters of the experiment setup.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nb">disp</span><span class="p">([</span><span class="s">'Vehicle Number = '</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">N</span><span class="p">)]);</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nb">disp</span><span class="p">([</span><span class="s">'v_star = '</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">v_star</span><span class="p">)]);</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="nb">disp</span><span class="p">([</span><span class="s">'s_star = '</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">s_star</span><span class="p">)]);</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="nb">disp</span><span class="p">([</span><span class="s">'v_ini = '</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">v_ini</span><span class="p">)]);</span>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="nb">disp</span><span class="p">([</span><span class="s">'controllerType = '</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">controllerType</span><span class="p">)]);</span>
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v_max</span><span class="o">*</span><span class="nb">pi</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">s_star</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">))</span><span class="o">-</span><span class="nb">alpha</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">beta</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">0</span>
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="nb">disp</span><span class="p">(</span><span class="s">'Satisfy Sufficient Condition!'</span><span class="p">);</span>
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="k">else</span>
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">    </span><span class="nb">disp</span><span class="p">(</span><span class="s">'Not Satisfy Sufficient Condition!'</span><span class="p">);</span>
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="k">end</span>
</code></pre></div>
<p>Simulation Module:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">sd_actuate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">NumStep</span><span class="o">-</span><span class="mi">1</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="c">%Update acceleration</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="n">temp</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">:(</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="n">V_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">temp</span><span class="o">-</span><span class="nb">reshape</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="k">end</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">Circumference</span><span class="p">;</span>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="n">temp</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">:(</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">    </span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">temp</span><span class="o">-</span><span class="nb">reshape</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%Real Following Distance</span>
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">    </span><span class="n">cal_D</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,:);</span><span class="w"> </span><span class="c">%For the boundary of Optimal Veloicity Calculation</span>
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">    </span><span class="n">cal_D</span><span class="p">(</span><span class="n">cal_D</span><span class="o">&gt;</span><span class="n">s_go</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">s_go</span><span class="p">;</span>
<a href="#__codelineno-14-12" id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">    </span><span class="n">cal_D</span><span class="p">(</span><span class="n">cal_D</span><span class="o">&lt;</span><span class="n">s_st</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">s_st</span><span class="p">;</span>
<a href="#__codelineno-14-13" id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">    </span><span class="c">%OVM Model</span>
<a href="#__codelineno-14-14" id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">    </span><span class="c">%V_d = v_max/2*(1-cos(pi*(h-h_st)/(h_go-h_st)));</span>
<a href="#__codelineno-14-15" id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">    </span><span class="c">%a2 = alpha*(V_h-v2)+beta*(v1-v2);</span>
<a href="#__codelineno-14-16" id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">    </span><span class="n">acel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">v_max</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">cal_D</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">)))</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="nb">beta</span><span class="o">*</span><span class="n">V_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,:);</span>
<a href="#__codelineno-14-17" id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">    </span><span class="n">acel</span><span class="p">(</span><span class="n">acel</span><span class="o">&gt;</span><span class="n">acel_max</span><span class="p">)=</span><span class="n">acel_max</span><span class="p">;</span>
<a href="#__codelineno-14-18" id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">    </span><span class="n">acel</span><span class="p">(</span><span class="n">acel</span><span class="o">&lt;</span><span class="n">dcel_max</span><span class="p">)=</span><span class="n">dcel_max</span><span class="p">;</span>
<a href="#__codelineno-14-19" id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">    </span><span class="c">% SD as ADAS to prevent crash</span>
<a href="#__codelineno-14-20" id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">    </span><span class="n">temp</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">:(</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-14-21" id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="w">    </span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c">%temp is the velocity of the preceding vehicle</span>
<a href="#__codelineno-14-22" id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="w">    </span><span class="n">acel_sd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">temp</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">./</span><span class="mi">2</span><span class="o">./</span><span class="nb">reshape</span><span class="p">(</span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,:),</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-14-23" id="__codelineno-14-23" name="__codelineno-14-23"></a><span class="w">    </span><span class="n">acel</span><span class="p">(</span><span class="n">acel_sd</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="n">dcel_max</span><span class="p">))</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dcel_max</span><span class="p">;</span>
<a href="#__codelineno-14-24" id="__codelineno-14-24" name="__codelineno-14-24"></a>
<a href="#__codelineno-14-25" id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="w">    </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">acel</span><span class="p">;</span>
<a href="#__codelineno-14-26" id="__codelineno-14-26" name="__codelineno-14-26"></a>
<a href="#__codelineno-14-27" id="__codelineno-14-27" name="__codelineno-14-27"></a>
<a href="#__codelineno-14-28" id="__codelineno-14-28" name="__codelineno-14-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">Tstep</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">Tstep</span><span class="o">&lt;</span><span class="mi">22</span><span class="p">)</span>
<a href="#__codelineno-14-29" id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="w">        </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">brakeID</span><span class="p">,</span><span class="mi">3</span><span class="p">)=</span><span class="o">-</span><span class="mi">5</span><span class="p">;</span>
<a href="#__codelineno-14-30" id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-14-31" id="__codelineno-14-31" name="__codelineno-14-31"></a>
<a href="#__codelineno-14-32" id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="o">&gt;</span><span class="n">ActuationTime</span><span class="o">/</span><span class="n">Tstep</span>
<a href="#__codelineno-14-33" id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="n">controllerType</span>
<a href="#__codelineno-14-34" id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span>
<a href="#__codelineno-14-35" id="__codelineno-14-35" name="__codelineno-14-35"></a><span class="w">                </span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,:),</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">s_ctr</span><span class="p">;</span>
<a href="#__codelineno-14-36" id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="w">                </span><span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">v_ctr</span><span class="p">;</span>
<a href="#__codelineno-14-37" id="__codelineno-14-37" name="__codelineno-14-37"></a><span class="w">                </span><span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">X</span><span class="p">(:,</span><span class="n">k</span><span class="p">);</span>
<a href="#__codelineno-14-38" id="__codelineno-14-38" name="__codelineno-14-38"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span>
<a href="#__codelineno-14-39" id="__codelineno-14-39" name="__codelineno-14-39"></a><span class="w">                </span><span class="n">dx10</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">9.5</span><span class="p">;</span><span class="w"> </span><span class="n">dx20</span><span class="p">=</span><span class="mf">10.75</span><span class="p">;</span><span class="w"> </span><span class="n">dx30</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
<a href="#__codelineno-14-40" id="__codelineno-14-40" name="__codelineno-14-40"></a><span class="w">                </span><span class="n">dv_temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span>
<a href="#__codelineno-14-41" id="__codelineno-14-41" name="__codelineno-14-41"></a><span class="w">                </span><span class="n">d1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">;</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="n">d3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a href="#__codelineno-14-42" id="__codelineno-14-42" name="__codelineno-14-42"></a><span class="w">                </span><span class="n">dx1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dx10</span><span class="o">+</span><span class="n">dv_temp</span>^<span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">d1</span><span class="p">;</span>
<a href="#__codelineno-14-43" id="__codelineno-14-43" name="__codelineno-14-43"></a><span class="w">                </span><span class="n">dx2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dx20</span><span class="o">+</span><span class="n">dv_temp</span>^<span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">d2</span><span class="p">;</span>
<a href="#__codelineno-14-44" id="__codelineno-14-44" name="__codelineno-14-44"></a><span class="w">                </span><span class="n">dx3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dx30</span><span class="o">+</span><span class="n">dv_temp</span>^<span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">d3</span><span class="p">;</span>
<a href="#__codelineno-14-45" id="__codelineno-14-45" name="__codelineno-14-45"></a><span class="w">                </span><span class="n">dx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
<a href="#__codelineno-14-46" id="__codelineno-14-46" name="__codelineno-14-46"></a><span class="w">                </span><span class="n">v_temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">12</span><span class="p">);</span>
<a href="#__codelineno-14-47" id="__codelineno-14-47" name="__codelineno-14-47"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">dx</span><span class="o">&lt;=</span><span class="n">d1</span>
<a href="#__codelineno-14-48" id="__codelineno-14-48" name="__codelineno-14-48"></a><span class="w">                    </span><span class="n">v_cmd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-14-49" id="__codelineno-14-49" name="__codelineno-14-49"></a><span class="w">                </span><span class="k">elseif</span><span class="w"> </span><span class="n">dx</span><span class="o">&lt;=</span><span class="n">d2</span>
<a href="#__codelineno-14-50" id="__codelineno-14-50" name="__codelineno-14-50"></a><span class="w">                    </span><span class="n">v_cmd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v_temp</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">-</span><span class="n">dx1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dx2</span><span class="o">-</span><span class="n">dx1</span><span class="p">);</span>
<a href="#__codelineno-14-51" id="__codelineno-14-51" name="__codelineno-14-51"></a><span class="w">                </span><span class="k">elseif</span><span class="w"> </span><span class="n">dx</span><span class="o">&lt;=</span><span class="n">d3</span>
<a href="#__codelineno-14-52" id="__codelineno-14-52" name="__codelineno-14-52"></a><span class="w">                    </span><span class="n">v_cmd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v_temp</span><span class="o">+</span><span class="p">(</span><span class="n">v_ctr</span><span class="o">-</span><span class="n">v_temp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">-</span><span class="n">dx2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dx3</span><span class="o">-</span><span class="n">dx2</span><span class="p">);</span>
<a href="#__codelineno-14-53" id="__codelineno-14-53" name="__codelineno-14-53"></a><span class="w">                </span><span class="k">else</span>
<a href="#__codelineno-14-54" id="__codelineno-14-54" name="__codelineno-14-54"></a><span class="w">                    </span><span class="n">v_cmd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v_ctr</span><span class="p">;</span>
<a href="#__codelineno-14-55" id="__codelineno-14-55" name="__codelineno-14-55"></a><span class="w">                </span><span class="k">end</span>
<a href="#__codelineno-14-56" id="__codelineno-14-56" name="__codelineno-14-56"></a><span class="w">                </span><span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">alpha_k</span><span class="o">*</span><span class="p">(</span><span class="n">v_cmd</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
<a href="#__codelineno-14-57" id="__codelineno-14-57" name="__codelineno-14-57"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span>
<a href="#__codelineno-14-58" id="__codelineno-14-58" name="__codelineno-14-58"></a><span class="w">                </span><span class="n">gl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="n">gu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w"> </span><span class="n">v_catch</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">gamma_temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a href="#__codelineno-14-59" id="__codelineno-14-59" name="__codelineno-14-59"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">26</span><span class="o">/</span><span class="n">Tstep</span><span class="o">&lt;=</span><span class="mi">0</span>
<a href="#__codelineno-14-60" id="__codelineno-14-60" name="__codelineno-14-60"></a><span class="w">                    </span><span class="n">v_hisAvg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
<a href="#__codelineno-14-61" id="__codelineno-14-61" name="__codelineno-14-61"></a><span class="w">                </span><span class="k">else</span>
<a href="#__codelineno-14-62" id="__codelineno-14-62" name="__codelineno-14-62"></a><span class="w">                    </span><span class="n">v_hisAvg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">S</span><span class="p">((</span><span class="n">k</span><span class="o">-</span><span class="mi">26</span><span class="o">/</span><span class="n">Tstep</span><span class="p">):</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
<a href="#__codelineno-14-63" id="__codelineno-14-63" name="__codelineno-14-63"></a><span class="w">                </span><span class="k">end</span>
<a href="#__codelineno-14-64" id="__codelineno-14-64" name="__codelineno-14-64"></a><span class="w">                </span><span class="n">v_target</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v_hisAvg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_catch</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">gl</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gu</span><span class="o">-</span><span class="n">gl</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-14-65" id="__codelineno-14-65" name="__codelineno-14-65"></a><span class="w">                </span><span class="n">alpha_temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">D_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">V_diff</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">),</span><span class="mi">4</span><span class="p">))</span><span class="o">/</span><span class="n">gamma_temp</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-14-66" id="__codelineno-14-66" name="__codelineno-14-66"></a><span class="w">                </span><span class="n">beta_temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">alpha_temp</span><span class="p">;</span>
<a href="#__codelineno-14-67" id="__codelineno-14-67" name="__codelineno-14-67"></a><span class="w">                </span><span class="n">v_cmd</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">beta_temp</span><span class="o">*</span><span class="p">(</span><span class="n">alpha_temp</span><span class="o">*</span><span class="n">v_target</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha_temp</span><span class="p">)</span><span class="o">*</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">beta_temp</span><span class="p">)</span><span class="o">*</span><span class="n">v_cmd</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<a href="#__codelineno-14-68" id="__codelineno-14-68" name="__codelineno-14-68"></a><span class="w">                </span><span class="n">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">alpha_k</span><span class="o">*</span><span class="p">(</span><span class="n">v_cmd</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
<a href="#__codelineno-14-69" id="__codelineno-14-69" name="__codelineno-14-69"></a><span class="w">        </span><span class="k">end</span>
<a href="#__codelineno-14-70" id="__codelineno-14-70" name="__codelineno-14-70"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">u</span><span class="o">&gt;</span><span class="n">acel_max</span>
<a href="#__codelineno-14-71" id="__codelineno-14-71" name="__codelineno-14-71"></a><span class="w">            </span><span class="n">u</span><span class="p">=</span><span class="n">acel_max</span><span class="p">;</span>
<a href="#__codelineno-14-72" id="__codelineno-14-72" name="__codelineno-14-72"></a><span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="n">u</span><span class="o">&lt;</span><span class="n">dcel_max</span>
<a href="#__codelineno-14-73" id="__codelineno-14-73" name="__codelineno-14-73"></a><span class="w">            </span><span class="n">u</span><span class="p">=</span><span class="n">dcel_max</span><span class="p">;</span>
<a href="#__codelineno-14-74" id="__codelineno-14-74" name="__codelineno-14-74"></a><span class="w">        </span><span class="k">end</span>
<a href="#__codelineno-14-75" id="__codelineno-14-75" name="__codelineno-14-75"></a>
<a href="#__codelineno-14-76" id="__codelineno-14-76" name="__codelineno-14-76"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>^<span class="mi">2</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">sd</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="n">dcel_max</span><span class="p">)</span>
<a href="#__codelineno-14-77" id="__codelineno-14-77" name="__codelineno-14-77"></a>
<a href="#__codelineno-14-78" id="__codelineno-14-78" name="__codelineno-14-78"></a><span class="w">            </span><span class="n">u</span><span class="p">=</span><span class="n">dcel_max</span><span class="p">;</span>
<a href="#__codelineno-14-79" id="__codelineno-14-79" name="__codelineno-14-79"></a><span class="w">        </span><span class="k">end</span>
<a href="#__codelineno-14-80" id="__codelineno-14-80" name="__codelineno-14-80"></a>
<a href="#__codelineno-14-81" id="__codelineno-14-81" name="__codelineno-14-81"></a><span class="w">        </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<a href="#__codelineno-14-82" id="__codelineno-14-82" name="__codelineno-14-82"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-14-83" id="__codelineno-14-83" name="__codelineno-14-83"></a><span class="w">    </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Tstep</span><span class="o">*</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-14-84" id="__codelineno-14-84" name="__codelineno-14-84"></a><span class="w">    </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Tstep</span><span class="o">*</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-14-85" id="__codelineno-14-85" name="__codelineno-14-85"></a>
<a href="#__codelineno-14-86" id="__codelineno-14-86" name="__codelineno-14-86"></a>
<a href="#__codelineno-14-87" id="__codelineno-14-87" name="__codelineno-14-87"></a><span class="k">end</span>
<a href="#__codelineno-14-88" id="__codelineno-14-88" name="__codelineno-14-88"></a>
<a href="#__codelineno-14-89" id="__codelineno-14-89" name="__codelineno-14-89"></a><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">NumStep</span>
<a href="#__codelineno-14-90" id="__codelineno-14-90" name="__codelineno-14-90"></a><span class="w">    </span><span class="n">V_avg</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">k</span><span class="p">,:,</span><span class="mi">2</span><span class="p">));</span>
<a href="#__codelineno-14-91" id="__codelineno-14-91" name="__codelineno-14-91"></a><span class="k">end</span>
</code></pre></div>
<p>Plots for Simulation result:</p>
<ul>
<li>
<p>Figure with color map indicating the relationship among the vehicle position and velocity and simulation time.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">figuresize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">250</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span><span class="mi">300</span><span class="p">];</span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">Lwidth</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">;</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="nb">figure</span><span class="p">;</span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="p">[</span><span class="n">xq</span><span class="p">,</span><span class="w"> </span><span class="n">yq</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">meshgrid</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">Circumference</span><span class="p">);</span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repmat</span><span class="p">(</span><span class="n">Tstep</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">S</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Circumference</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">S</span><span class="p">(:,</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Circumference</span><span class="p">)</span><span class="o">'</span><span class="p">];</span>
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="k">end</span>
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">2</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">z</span><span class="w"> </span><span class="n">S</span><span class="p">(:,</span><span class="nb">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">'</span><span class="p">];</span>
<a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="k">end</span>
<a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="n">Wsize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a>
<a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="n">zq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">xq</span><span class="p">,</span><span class="n">yq</span><span class="p">);</span>
<a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="nb">mesh</span><span class="p">(</span><span class="n">xq</span><span class="p">,</span><span class="n">yq</span><span class="p">,</span><span class="n">zq</span><span class="p">);</span>
<a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="nb">view</span><span class="p">([</span><span class="mi">0</span><span class="w"> </span><span class="mi">90</span><span class="p">]);</span>
<a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="nb">colormap</span><span class="p">(</span><span class="nb">hot</span><span class="p">);</span>
<a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="c">%colormap(flipud(colormap));</span>
<a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="nb">caxis</span><span class="p">([</span><span class="mi">0</span><span class="w"> </span><span class="mi">15</span><span class="p">]);</span>
<a href="#__codelineno-15-23" id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="n">hcb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">colorbar</span><span class="p">;</span>
<a href="#__codelineno-15-24" id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="n">hcb</span><span class="p">.</span><span class="n">TickLabelInterpreter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">'latex'</span><span class="p">;</span>
<a href="#__codelineno-15-25" id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="n">hcb</span><span class="p">.</span><span class="n">FontSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">14</span><span class="p">;</span>
<a href="#__codelineno-15-26" id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="nb">set</span><span class="p">(</span><span class="nb">gca</span><span class="p">,</span><span class="s">'TickLabelInterpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="mi">14</span><span class="p">);</span>
<a href="#__codelineno-15-27" id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="nb">xlabel</span><span class="p">(</span><span class="s">'$t\;[\mathrm{s}]$'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="n">Wsize</span><span class="p">,</span><span class="s">'Interpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">,</span><span class="s">'Color'</span><span class="p">,</span><span class="s">'k'</span><span class="p">);</span>
<a href="#__codelineno-15-28" id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="nb">ylabel</span><span class="p">(</span><span class="s">'Position $[\mathrm{m}]$'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="n">Wsize</span><span class="p">,</span><span class="s">'Interpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">,</span><span class="s">'Color'</span><span class="p">,</span><span class="s">'k'</span><span class="p">);</span>
<a href="#__codelineno-15-29" id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="nb">clabel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">get</span><span class="p">(</span><span class="n">hcb</span><span class="p">,</span><span class="s">'label'</span><span class="p">);</span>
<a href="#__codelineno-15-30" id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="nb">set</span><span class="p">(</span><span class="nb">clabel</span><span class="p">,</span><span class="s">'String'</span><span class="p">,</span><span class="s">'Velocity $[\mathrm{m/s}]$'</span><span class="p">,</span><span class="s">'Interpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="n">Wsize</span><span class="p">,</span><span class="s">'Color'</span><span class="p">,</span><span class="s">'k'</span><span class="p">);</span>
</code></pre></div></p>
</li>
<li>
<p>Plot for the brakeID vehicle and AV:
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nb">hold</span><span class="w"> </span><span class="n">on</span><span class="p">;</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">ID</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">        </span><span class="nb">plot3</span><span class="p">(</span><span class="n">Tstep</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="nb">mod</span><span class="p">(</span><span class="n">S</span><span class="p">(:,</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Circumference</span><span class="p">),</span><span class="mi">30</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">TotalTime</span><span class="o">/</span><span class="n">Tstep</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s">'.'</span><span class="p">,</span><span class="s">'color'</span><span class="p">,[</span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="s">'markersize'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">        </span><span class="c">%For Label</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">        </span><span class="n">p1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">plot3</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">Circumference</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nb">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s">'color'</span><span class="p">,[</span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="s">'linewidth'</span><span class="p">,</span><span class="n">Lwidth</span><span class="p">);</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">    </span><span class="k">else</span>
<a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">        </span><span class="nb">plot3</span><span class="p">(</span><span class="n">Tstep</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="nb">mod</span><span class="p">(</span><span class="n">S</span><span class="p">(:,</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Circumference</span><span class="p">),</span><span class="mi">30</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">TotalTime</span><span class="o">/</span><span class="n">Tstep</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s">'.'</span><span class="p">,</span><span class="s">'color'</span><span class="p">,[</span><span class="mi">0</span><span class="w"> </span><span class="mf">0.4470</span><span class="w"> </span><span class="mf">0.7410</span><span class="p">],</span><span class="s">'markersize'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">        </span><span class="c">%For Label</span>
<a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">        </span><span class="n">p2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">plot3</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">Circumference</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nb">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s">'color'</span><span class="p">,[</span><span class="mi">0</span><span class="w"> </span><span class="mf">0.4470</span><span class="w"> </span><span class="mf">0.7410</span><span class="p">],</span><span class="s">'linewidth'</span><span class="p">,</span><span class="n">Lwidth</span><span class="p">);</span>
<a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="nb">hold</span><span class="w"> </span><span class="n">on</span><span class="p">;</span>
<a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="k">end</span>
<a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="c">%Brake Time</span>
<a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="nb">plot3</span><span class="p">(</span><span class="mi">20</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="nb">mod</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">20</span><span class="o">/</span><span class="n">Tstep</span><span class="p">:</span><span class="mi">22</span><span class="o">/</span><span class="n">Tstep</span><span class="p">,</span><span class="n">brakeID</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Circumference</span><span class="p">),</span><span class="mi">30</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">Tstep</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s">'.'</span><span class="p">,</span><span class="s">'color'</span><span class="p">,[</span><span class="mf">0.6350</span><span class="w"> </span><span class="mf">0.0780</span><span class="w"> </span><span class="mf">0.1840</span><span class="p">],</span><span class="s">'markersize'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="c">%scatter3(Tstep:Tstep:TotalTime,mod(S(:,brakeID,1),Circumference),30*ones(TotalTime/Tstep,1),4,'k','filled');</span>
<a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a>
<a href="#__codelineno-16-18" id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="nb">axis</span><span class="p">([</span><span class="mi">0</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">Circumference</span><span class="p">]);</span>
<a href="#__codelineno-16-19" id="__codelineno-16-19" name="__codelineno-16-19"></a>
<a href="#__codelineno-16-20" id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="nb">set</span><span class="p">(</span><span class="nb">gcf</span><span class="p">,</span><span class="s">'Position'</span><span class="p">,</span><span class="n">figuresize</span><span class="p">);</span>
<a href="#__codelineno-16-21" id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="n">fig</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">gcf</span><span class="p">;</span>
<a href="#__codelineno-16-22" id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="n">fig</span><span class="p">.</span><span class="n">PaperPositionMode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">'auto'</span><span class="p">;</span>
<a href="#__codelineno-16-23" id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="c">% print(gcf,['figs/StrongPerturbationAV_1'],'-depsc2','-r600');</span>
<a href="#__codelineno-16-24" id="__codelineno-16-24" name="__codelineno-16-24"></a>
<a href="#__codelineno-16-25" id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="c">%Velocity</span>
<a href="#__codelineno-16-26" id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="nb">figure</span><span class="p">;</span>
<a href="#__codelineno-16-27" id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-16-28" id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">ID</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<a href="#__codelineno-16-29" id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="w">        </span><span class="n">p1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">plot</span><span class="p">(</span><span class="n">Tstep</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="n">S</span><span class="p">(:,</span><span class="nb">i</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s">'-'</span><span class="p">,</span><span class="s">'linewidth'</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">'Color'</span><span class="p">,[</span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">);</span>
<a href="#__codelineno-16-30" id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="w">    </span><span class="k">else</span>
<a href="#__codelineno-16-31" id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="w">        </span><span class="n">p2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">plot</span><span class="p">(</span><span class="n">Tstep</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="n">S</span><span class="p">(:,</span><span class="nb">i</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s">'-'</span><span class="p">,</span><span class="s">'linewidth'</span><span class="p">,</span><span class="n">Lwidth</span><span class="p">,</span><span class="s">'Color'</span><span class="p">,[</span><span class="mi">0</span><span class="w"> </span><span class="mf">0.4470</span><span class="w"> </span><span class="mf">0.7410</span><span class="p">]);</span>
<a href="#__codelineno-16-32" id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-16-33" id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="w">    </span><span class="nb">hold</span><span class="w"> </span><span class="n">on</span><span class="p">;</span>
<a href="#__codelineno-16-34" id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="k">end</span>
<a href="#__codelineno-16-35" id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="n">p3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">plot</span><span class="p">(</span><span class="n">Tstep</span><span class="p">:</span><span class="n">Tstep</span><span class="p">:</span><span class="n">TotalTime</span><span class="p">,</span><span class="n">V_avg</span><span class="p">,</span><span class="s">'-'</span><span class="p">,</span><span class="s">'linewidth'</span><span class="p">,</span><span class="n">Lwidth</span><span class="p">,</span><span class="s">'Color'</span><span class="p">,</span><span class="s">'k'</span><span class="p">);</span>
</code></pre></div></p>
</li>
</ul>
<p>Animation module:</p>
<ul>
<li>
<p>Animation Setup
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c">%% Animation</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="k">if</span><span class="w"> </span><span class="n">mix</span>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="n">videoFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">'Mix.mp4'</span><span class="p">;</span>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="k">else</span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="n">videoFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">'HDV.mp4'</span><span class="p">;</span>
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="k">end</span>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="k">if</span><span class="w"> </span><span class="n">videoOutput</span>
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="n">myVideo</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">VideoWriter</span><span class="p">(</span><span class="n">videoFile</span><span class="p">,</span><span class="s">'MPEG-4'</span><span class="p">);</span>
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="nb">open</span><span class="p">(</span><span class="n">myVideo</span><span class="p">);</span>
<a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="k">end</span>
<a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>
<a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="nb">load</span><span class="p">(</span><span class="s">'Animation_Color.mat'</span><span class="p">);</span>
<a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="nb">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="nb">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">'defaultfigurecolor'</span><span class="p">,</span><span class="s">'w'</span><span class="p">);</span>
<a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="n">ax1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="c">% vehicle position</span>
<a href="#__codelineno-17-19" id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="n">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Circumference</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="nb">pi</span><span class="p">;</span>
<a href="#__codelineno-17-20" id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="k">for</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-17-21" id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">    </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">plot</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Circumference</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">),</span><span class="n">R</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Circumference</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">),</span><span class="s">'o'</span><span class="p">);</span>
<a href="#__codelineno-17-22" id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">    </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">vehicleSize</span><span class="p">;</span>
<a href="#__codelineno-17-23" id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">mix</span>
<a href="#__codelineno-17-24" id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">        </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerFaceColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">146</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">80</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<a href="#__codelineno-17-25" id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="w">        </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerEdgeColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<a href="#__codelineno-17-26" id="__codelineno-17-26" name="__codelineno-17-26"></a><span class="w">    </span><span class="k">else</span>
<a href="#__codelineno-17-27" id="__codelineno-17-27" name="__codelineno-17-27"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">20</span>
<a href="#__codelineno-17-28" id="__codelineno-17-28" name="__codelineno-17-28"></a><span class="w">            </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerFaceColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">176</span><span class="p">,</span><span class="mi">240</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<a href="#__codelineno-17-29" id="__codelineno-17-29" name="__codelineno-17-29"></a><span class="w">            </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerEdgeColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<a href="#__codelineno-17-30" id="__codelineno-17-30" name="__codelineno-17-30"></a><span class="w">        </span><span class="k">else</span>
<a href="#__codelineno-17-31" id="__codelineno-17-31" name="__codelineno-17-31"></a><span class="w">            </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerFaceColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">146</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">80</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<a href="#__codelineno-17-32" id="__codelineno-17-32" name="__codelineno-17-32"></a><span class="w">            </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerEdgeColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<a href="#__codelineno-17-33" id="__codelineno-17-33" name="__codelineno-17-33"></a><span class="w">        </span><span class="k">end</span>
<a href="#__codelineno-17-34" id="__codelineno-17-34" name="__codelineno-17-34"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-17-35" id="__codelineno-17-35" name="__codelineno-17-35"></a><span class="w">    </span><span class="nb">hold</span><span class="w"> </span><span class="n">on</span><span class="p">;</span>
<a href="#__codelineno-17-36" id="__codelineno-17-36" name="__codelineno-17-36"></a><span class="k">end</span>
<a href="#__codelineno-17-37" id="__codelineno-17-37" name="__codelineno-17-37"></a><span class="nb">axis</span><span class="w"> </span><span class="n">equal</span><span class="p">;</span>
<a href="#__codelineno-17-38" id="__codelineno-17-38" name="__codelineno-17-38"></a><span class="n">axis</span><span class="w"> </span><span class="s">manual</span><span class="p">;</span>
<a href="#__codelineno-17-39" id="__codelineno-17-39" name="__codelineno-17-39"></a><span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="n">R</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="n">R</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="n">R</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="n">R</span><span class="o">+</span><span class="mi">20</span><span class="p">]);</span>
<a href="#__codelineno-17-40" id="__codelineno-17-40" name="__codelineno-17-40"></a><span class="nb">set</span><span class="p">(</span><span class="nb">gcf</span><span class="p">,</span><span class="s">'Position'</span><span class="p">,[</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">450</span><span class="p">]);</span>
<a href="#__codelineno-17-41" id="__codelineno-17-41" name="__codelineno-17-41"></a><span class="n">axis</span><span class="w"> </span><span class="s">off</span><span class="p">;</span>
<a href="#__codelineno-17-42" id="__codelineno-17-42" name="__codelineno-17-42"></a><span class="c">% Color</span>
<a href="#__codelineno-17-43" id="__codelineno-17-43" name="__codelineno-17-43"></a><span class="nb">colormap</span><span class="p">(</span><span class="n">velocityMap</span><span class="p">);</span>
<a href="#__codelineno-17-44" id="__codelineno-17-44" name="__codelineno-17-44"></a>
<a href="#__codelineno-17-45" id="__codelineno-17-45" name="__codelineno-17-45"></a><span class="n">hcb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">colorbar</span><span class="p">;</span>
<a href="#__codelineno-17-46" id="__codelineno-17-46" name="__codelineno-17-46"></a><span class="nb">clabel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">get</span><span class="p">(</span><span class="n">hcb</span><span class="p">,</span><span class="s">'label'</span><span class="p">);</span>
<a href="#__codelineno-17-47" id="__codelineno-17-47" name="__codelineno-17-47"></a><span class="nb">caxis</span><span class="p">([</span><span class="n">velLowerBound</span><span class="p">,</span><span class="n">velUpperBound</span><span class="p">]);</span>
<a href="#__codelineno-17-48" id="__codelineno-17-48" name="__codelineno-17-48"></a><span class="nb">set</span><span class="p">(</span><span class="nb">clabel</span><span class="p">,</span><span class="s">'String'</span><span class="p">,</span><span class="s">'Velocity $[\mathrm{m/s}]$'</span><span class="p">,</span><span class="s">'Interpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span>
<a href="#__codelineno-17-49" id="__codelineno-17-49" name="__codelineno-17-49"></a><span class="n">hcb</span><span class="p">.</span><span class="n">TickLabelInterpreter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">'latex'</span><span class="p">;</span>
<a href="#__codelineno-17-50" id="__codelineno-17-50" name="__codelineno-17-50"></a><span class="n">hcb</span><span class="p">.</span><span class="n">FontSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a href="#__codelineno-17-51" id="__codelineno-17-51" name="__codelineno-17-51"></a><span class="n">hcb</span><span class="p">.</span><span class="n">Position</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.13</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="mf">0.01</span><span class="w"> </span><span class="mf">0.5</span><span class="p">];</span>
<a href="#__codelineno-17-52" id="__codelineno-17-52" name="__codelineno-17-52"></a><span class="c">% Road</span>
<a href="#__codelineno-17-53" id="__codelineno-17-53" name="__codelineno-17-53"></a><span class="n">temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<a href="#__codelineno-17-54" id="__codelineno-17-54" name="__codelineno-17-54"></a><span class="nb">plot</span><span class="p">(</span><span class="mf">0.87</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="mf">0.87</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="s">'k'</span><span class="p">,</span><span class="s">'LineWidth'</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span>
<a href="#__codelineno-17-55" id="__codelineno-17-55" name="__codelineno-17-55"></a><span class="nb">plot</span><span class="p">(</span><span class="mf">1.13</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="mf">1.13</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="s">'k'</span><span class="p">,</span><span class="s">'LineWidth'</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span>
<a href="#__codelineno-17-56" id="__codelineno-17-56" name="__codelineno-17-56"></a>
<a href="#__codelineno-17-57" id="__codelineno-17-57" name="__codelineno-17-57"></a><span class="n">ax2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-17-58" id="__codelineno-17-58" name="__codelineno-17-58"></a><span class="k">for</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-17-59" id="__codelineno-17-59" name="__codelineno-17-59"></a><span class="w">    </span><span class="n">velocity</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">animatedline</span><span class="p">(</span><span class="s">'Color'</span><span class="p">,[</span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="w"> </span><span class="mi">190</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="s">'linewidth'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-17-60" id="__codelineno-17-60" name="__codelineno-17-60"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">mix</span>
<a href="#__codelineno-17-61" id="__codelineno-17-61" name="__codelineno-17-61"></a><span class="w">        </span><span class="n">velocity</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">animatedline</span><span class="p">(</span><span class="s">'Color'</span><span class="p">,[</span><span class="mi">0</span><span class="w"> </span><span class="mf">0.4470</span><span class="w"> </span><span class="mf">0.7410</span><span class="p">],</span><span class="s">'linewidth'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">);</span>
<a href="#__codelineno-17-62" id="__codelineno-17-62" name="__codelineno-17-62"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-17-63" id="__codelineno-17-63" name="__codelineno-17-63"></a><span class="k">end</span>
<a href="#__codelineno-17-64" id="__codelineno-17-64" name="__codelineno-17-64"></a><span class="nb">axis</span><span class="w"> </span><span class="n">manual</span><span class="p">;</span>
<a href="#__codelineno-17-65" id="__codelineno-17-65" name="__codelineno-17-65"></a><span class="nb">axis</span><span class="p">([</span><span class="mi">10</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">30</span><span class="p">]);</span>
<a href="#__codelineno-17-66" id="__codelineno-17-66" name="__codelineno-17-66"></a><span class="nb">set</span><span class="p">(</span><span class="nb">gca</span><span class="p">,</span><span class="s">'TickLabelInterpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<a href="#__codelineno-17-67" id="__codelineno-17-67" name="__codelineno-17-67"></a><span class="nb">xlabel</span><span class="p">(</span><span class="s">'$t\;[\mathrm{s}]$'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">'Interpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">);</span>
<a href="#__codelineno-17-68" id="__codelineno-17-68" name="__codelineno-17-68"></a><span class="nb">ylabel</span><span class="p">(</span><span class="s">'Velocity $[\mathrm{m/s}]$'</span><span class="p">,</span><span class="s">'fontsize'</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">'Interpreter'</span><span class="p">,</span><span class="s">'latex'</span><span class="p">);</span>
<a href="#__codelineno-17-69" id="__codelineno-17-69" name="__codelineno-17-69"></a>
<a href="#__codelineno-17-70" id="__codelineno-17-70" name="__codelineno-17-70"></a><span class="n">fig</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">gcf</span><span class="p">;</span>
<a href="#__codelineno-17-71" id="__codelineno-17-71" name="__codelineno-17-71"></a><span class="n">fig</span><span class="p">.</span><span class="n">Children</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Position</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.52</span><span class="w"> </span><span class="mf">0.26</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="mf">0.5</span><span class="p">];</span>
</code></pre></div></p>
</li>
<li>
<p>Update for the Animation (show the update the vehicle location and state in the animation according to previous simulation data.
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">10</span><span class="o">/</span><span class="n">Tstep</span><span class="p">:</span><span class="mi">10</span><span class="p">:(</span><span class="n">TotalTime</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="n">Tstep</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">        </span><span class="n">ax1</span><span class="p">;</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">        </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">XData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">R</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Circumference</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">);</span>
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">        </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">YData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">R</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Circumference</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">);</span>
<a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="n">velLowerBound</span>
<a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">velLowerBound</span><span class="p">;</span>
<a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">        </span><span class="k">elseif</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">velUpperBound</span>
<a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">velUpperBound</span><span class="p">;</span>
<a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">        </span><span class="k">else</span>
<a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">        </span><span class="k">end</span>
<a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">        </span><span class="n">colorID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">floor</span><span class="p">((</span><span class="n">temp</span><span class="o">-</span><span class="n">velLowerBound</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">velUpperBound</span><span class="o">-</span><span class="n">velLowerBound</span><span class="p">)</span><span class="o">*</span><span class="nb">size</span><span class="p">(</span><span class="n">velocityMap</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">velocityMap</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
<a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">        </span><span class="n">position</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="n">MarkerFaceColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">velocityMap</span><span class="p">(</span><span class="n">colorID</span><span class="p">,:);</span>
<a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">mix</span>
<a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w">            </span><span class="n">position</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="n">MarkerFaceColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">176</span><span class="p">,</span><span class="mi">240</span><span class="p">]</span><span class="o">/</span><span class="mi">255</span><span class="p">;</span>
<a href="#__codelineno-18-19" id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w">        </span><span class="k">end</span>
<a href="#__codelineno-18-20" id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">        </span><span class="n">ax2</span><span class="p">;</span>
<a href="#__codelineno-18-21" id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">        </span><span class="nb">addpoints</span><span class="p">(</span><span class="n">velocity</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="nb">i</span><span class="o">*</span><span class="n">Tstep</span><span class="p">,</span><span class="n">S</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
<a href="#__codelineno-18-22" id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-18-23" id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">getframe</span><span class="p">(</span><span class="nb">gcf</span><span class="p">);</span>
<a href="#__codelineno-18-24" id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">videoOutput</span>
<a href="#__codelineno-18-25" id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="w">    </span><span class="nb">writeVideo</span><span class="p">(</span><span class="n">myVideo</span><span class="p">,</span><span class="n">frame</span><span class="p">);</span>
<a href="#__codelineno-18-26" id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-18-27" id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="w">    </span><span class="nb">drawnow</span><span class="p">;</span>
<a href="#__codelineno-18-28" id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="w">    </span><span class="nb">pause</span><span class="p">(</span><span class="mf">0.05</span><span class="p">);</span>
<a href="#__codelineno-18-29" id="__codelineno-18-29" name="__codelineno-18-29"></a><span class="w">    </span><span class="c">%pause(0.1);</span>
<a href="#__codelineno-18-30" id="__codelineno-18-30" name="__codelineno-18-30"></a>
<a href="#__codelineno-18-31" id="__codelineno-18-31" name="__codelineno-18-31"></a><span class="k">end</span>
<a href="#__codelineno-18-32" id="__codelineno-18-32" name="__codelineno-18-32"></a><span class="k">if</span><span class="w"> </span><span class="n">videoOutput</span>
<a href="#__codelineno-18-33" id="__codelineno-18-33" name="__codelineno-18-33"></a><span class="nb">close</span><span class="p">(</span><span class="n">myVideo</span><span class="p">);</span>
<a href="#__codelineno-18-34" id="__codelineno-18-34" name="__codelineno-18-34"></a><span class="k">end</span>
</code></pre></div></p>
</li>
</ul>
<h4 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">¶</a></h4>
<h5 id="lqr_sdpm"><a href="https://github.com/soc-ucsd/mixed-traffic/blob/main/smoothing_traffic_flow_via_AVs/_fcn/lqr_sdp.m">lqr_sdp.m</a><a class="headerlink" href="#lqr_sdpm" title="Permanent link">¶</a></h5>
<p>This function will generate the K value (the feedback gain) for the control input u(t) setup. </p>
<p>Optimal control input: u(t) = −Kx</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">function</span><span class="w"> </span>[K]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">lqr_sdp</span><span class="p">(</span>N,s_star,gamma_s,gamma_v,gamma_u,AV_number<span class="p">)</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="nb">disp</span><span class="p">([</span><span class="s">'N = '</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">N</span><span class="p">)]);</span>
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="n">epsilon</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">;</span>
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="p">[</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">R</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ring_traffic_model</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">s_star</span><span class="p">,</span><span class="n">gamma_s</span><span class="p">,</span><span class="n">gamma_v</span><span class="p">,</span><span class="n">gamma_u</span><span class="p">,</span><span class="n">AV_number</span><span class="p">);</span><span class="w">   </span><span class="c">% Dynamics &amp; Performance index</span>
<a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>
<a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>
<a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="c">%% Call Yalmip</span>
<a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c">% number of states</span>
<a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w">  </span><span class="c">% number of inputs</span>
<a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>
<a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="c">% assume each vehicle has a deviation</span>
<a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="n">B1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">eye</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="n">B1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="c">% B1 = B;</span>
<a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="c">% assume disturbance is the same as inout</span>
<a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>
<a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="c">% variables</span>
<a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="n">X</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sdpvar</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<a href="#__codelineno-19-24" id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="n">Z</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sdpvar</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<a href="#__codelineno-19-25" id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="n">Y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sdpvar</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
<a href="#__codelineno-19-26" id="__codelineno-19-26" name="__codelineno-19-26"></a>
<a href="#__codelineno-19-27" id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="c">% constraints</span>
<a href="#__codelineno-19-28" id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="n">Constraints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">B</span><span class="o">*</span><span class="n">Z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">B</span><span class="o">*</span><span class="n">Z</span><span class="p">)</span><span class="o">'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B1</span><span class="o">*</span><span class="n">B1</span><span class="o">'</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">,</span>
<a href="#__codelineno-19-29" id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">               </span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">epsilon</span><span class="o">*</span><span class="nb">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span>
<a href="#__codelineno-19-30" id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">               </span><span class="p">[</span><span class="n">Y</span><span class="w"> </span><span class="n">Z</span><span class="p">;</span><span class="n">Z</span><span class="o">'</span><span class="w"> </span><span class="n">X</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">];</span>
<a href="#__codelineno-19-31" id="__codelineno-19-31" name="__codelineno-19-31"></a>
<a href="#__codelineno-19-32" id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="n">obj</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="nb">trace</span><span class="p">(</span><span class="n">Q</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">trace</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">Y</span><span class="p">);</span>
<a href="#__codelineno-19-33" id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="c">%opts  = sdpsettings('solver','sedumi');   % call SDP solver: sedumi</span>
<a href="#__codelineno-19-34" id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="n">opts</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">sdpsettings</span><span class="p">(</span><span class="s">'solver'</span><span class="p">,</span><span class="s">'mosek'</span><span class="p">);</span><span class="w">     </span><span class="c">% call SDP solver: mosek, this is often better</span>
<a href="#__codelineno-19-35" id="__codelineno-19-35" name="__codelineno-19-35"></a>
<a href="#__codelineno-19-36" id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="n">sol</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="n">optimize</span><span class="p">(</span><span class="n">Constraints</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">opts</span><span class="p">);</span>
<a href="#__codelineno-19-37" id="__codelineno-19-37" name="__codelineno-19-37"></a>
<a href="#__codelineno-19-38" id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="n">Xd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
<a href="#__codelineno-19-39" id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="n">Zd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">Z</span><span class="p">);</span>
<a href="#__codelineno-19-40" id="__codelineno-19-40" name="__codelineno-19-40"></a>
<a href="#__codelineno-19-41" id="__codelineno-19-41" name="__codelineno-19-41"></a><span class="n">K</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Zd</span><span class="o">*</span><span class="n">Xd</span>^<span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-19-42" id="__codelineno-19-42" name="__codelineno-19-42"></a>
<a href="#__codelineno-19-43" id="__codelineno-19-43" name="__codelineno-19-43"></a><span class="k">end</span>
</code></pre></div>
<h5 id="ring_traffic_modelm"><a href="https://github.com/soc-ucsd/mixed-traffic/blob/main/smoothing_traffic_flow_via_AVs/_fcn/ring_traffic_model.m">ring_traffic_model.m</a><a class="headerlink" href="#ring_traffic_modelm" title="Permanent link">¶</a></h5>
<p>This function generate the dynamic model for the OVM model.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">function</span><span class="w"> </span>[A,B,Q,R]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">ring_traffic_model</span><span class="p">(</span>N,s_star,gamma_s,gamma_v,gamma_u,AV_number<span class="p">)</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="c">% Generate a dynamic model for </span>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="c">%OVM</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="c">%     if nargin &lt; 2</span>
<a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="c">%         OVM = 1;</span>
<a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="c">%     end</span>
<a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">    </span><span class="n">OVM</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a>
<a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">    </span><span class="nb">alpha</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mf">0.6</span><span class="p">;</span>
<a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">    </span><span class="nb">beta</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="mf">0.9</span><span class="p">;</span>
<a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">    </span><span class="n">v_max</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">    </span><span class="n">s_st</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">    </span><span class="n">s_go</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="mi">35</span><span class="p">;</span>
<a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">    </span><span class="c">%s_star = 0.5*(s_st+s_go);</span>
<a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a>
<a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">    </span><span class="c">% General</span>
<a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">OVM</span>
<a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="w">        </span><span class="n">alpha1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">alpha</span><span class="o">*</span><span class="n">v_max</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">s_star</span><span class="o">-</span><span class="n">s_st</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">s_go</span><span class="o">-</span><span class="n">s_st</span><span class="p">));</span>
<a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">        </span><span class="n">alpha2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">alpha</span><span class="o">+</span><span class="nb">beta</span><span class="p">;</span>
<a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">        </span><span class="n">alpha3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">beta</span><span class="p">;</span>
<a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">    </span><span class="k">else</span>
<a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">        </span><span class="n">alpha1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.6</span><span class="p">;</span>
<a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="w">        </span><span class="n">alpha2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">        </span><span class="n">alpha3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a>
<a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a>
<a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="w">    </span><span class="n">A1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">alpha1</span><span class="p">,</span><span class="o">-</span><span class="n">alpha2</span><span class="p">];</span>
<a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="w">    </span><span class="n">A2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">,</span><span class="n">alpha3</span><span class="p">];</span>
<a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="w">    </span><span class="n">C1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<a href="#__codelineno-20-32" id="__codelineno-20-32" name="__codelineno-20-32"></a><span class="w">    </span><span class="n">C2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<a href="#__codelineno-20-33" id="__codelineno-20-33" name="__codelineno-20-33"></a>
<a href="#__codelineno-20-34" id="__codelineno-20-34" name="__codelineno-20-34"></a>
<a href="#__codelineno-20-35" id="__codelineno-20-35" name="__codelineno-20-35"></a><span class="w">    </span><span class="n">pos1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-20-36" id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="w">    </span><span class="n">pos2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
<a href="#__codelineno-20-37" id="__codelineno-20-37" name="__codelineno-20-37"></a>
<a href="#__codelineno-20-38" id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="w">    </span><span class="c">%Y = AY+Bu</span>
<a href="#__codelineno-20-39" id="__codelineno-20-39" name="__codelineno-20-39"></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">);</span>
<a href="#__codelineno-20-40" id="__codelineno-20-40" name="__codelineno-20-40"></a>
<a href="#__codelineno-20-41" id="__codelineno-20-41" name="__codelineno-20-41"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a href="#__codelineno-20-42" id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="w">        </span><span class="n">A</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="p">),(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos1</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos1</span><span class="p">))=</span><span class="n">A1</span><span class="p">;</span>
<a href="#__codelineno-20-43" id="__codelineno-20-43" name="__codelineno-20-43"></a><span class="w">        </span><span class="n">A</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="p">),(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos2</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos2</span><span class="p">))=</span><span class="n">A2</span><span class="p">;</span>
<a href="#__codelineno-20-44" id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="w">        </span><span class="n">pos1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">pos1</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-20-45" id="__codelineno-20-45" name="__codelineno-20-45"></a><span class="w">        </span><span class="n">pos2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
<a href="#__codelineno-20-46" id="__codelineno-20-46" name="__codelineno-20-46"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-20-47" id="__codelineno-20-47" name="__codelineno-20-47"></a><span class="w">    </span><span class="n">A</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">),(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos1</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos1</span><span class="p">))=</span><span class="n">C1</span><span class="p">;</span>
<a href="#__codelineno-20-48" id="__codelineno-20-48" name="__codelineno-20-48"></a><span class="w">    </span><span class="n">A</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">),(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos2</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">pos2</span><span class="p">))=</span><span class="n">C2</span><span class="p">;</span>
<a href="#__codelineno-20-49" id="__codelineno-20-49" name="__codelineno-20-49"></a><span class="w">    </span><span class="c">%Controller</span>
<a href="#__codelineno-20-50" id="__codelineno-20-50" name="__codelineno-20-50"></a>
<a href="#__codelineno-20-51" id="__codelineno-20-51" name="__codelineno-20-51"></a><span class="w">    </span><span class="n">Q</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">);</span>
<a href="#__codelineno-20-52" id="__codelineno-20-52" name="__codelineno-20-52"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
<a href="#__codelineno-20-53" id="__codelineno-20-53" name="__codelineno-20-53"></a><span class="w">        </span><span class="n">Q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gamma_s</span><span class="p">;</span>
<a href="#__codelineno-20-54" id="__codelineno-20-54" name="__codelineno-20-54"></a><span class="w">        </span><span class="n">Q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gamma_v</span><span class="p">;</span>
<a href="#__codelineno-20-55" id="__codelineno-20-55" name="__codelineno-20-55"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-20-56" id="__codelineno-20-56" name="__codelineno-20-56"></a>
<a href="#__codelineno-20-57" id="__codelineno-20-57" name="__codelineno-20-57"></a><span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">AV_number</span><span class="p">);</span>
<a href="#__codelineno-20-58" id="__codelineno-20-58" name="__codelineno-20-58"></a><span class="w">    </span><span class="n">B</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-20-59" id="__codelineno-20-59" name="__codelineno-20-59"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">AV_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
<a href="#__codelineno-20-60" id="__codelineno-20-60" name="__codelineno-20-60"></a><span class="w">        </span><span class="n">AV2_Index</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-20-61" id="__codelineno-20-61" name="__codelineno-20-61"></a><span class="w">        </span><span class="n">A</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="p">),(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="p">))=</span><span class="n">C1</span><span class="p">;</span>
<a href="#__codelineno-20-62" id="__codelineno-20-62" name="__codelineno-20-62"></a><span class="w">        </span><span class="n">A</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="o">-</span><span class="mi">1</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="p">),(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="o">-</span><span class="mi">3</span><span class="p">):(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="o">-</span><span class="mi">2</span><span class="p">))=</span><span class="n">C2</span><span class="p">;</span>
<a href="#__codelineno-20-63" id="__codelineno-20-63" name="__codelineno-20-63"></a><span class="w">        </span><span class="n">B</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">AV2_Index</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-20-64" id="__codelineno-20-64" name="__codelineno-20-64"></a><span class="w">    </span><span class="k">end</span>
<a href="#__codelineno-20-65" id="__codelineno-20-65" name="__codelineno-20-65"></a>
<a href="#__codelineno-20-66" id="__codelineno-20-66" name="__codelineno-20-66"></a><span class="w">    </span><span class="n">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gamma_u</span><span class="o">*</span><span class="nb">eye</span><span class="p">(</span><span class="n">AV_number</span><span class="p">,</span><span class="n">AV_number</span><span class="p">);</span>
<a href="#__codelineno-20-67" id="__codelineno-20-67" name="__codelineno-20-67"></a><span class="w">    </span><span class="c">%[K,S,e] = lqr(A,B,Q,R,0);</span>
<a href="#__codelineno-20-68" id="__codelineno-20-68" name="__codelineno-20-68"></a><span class="w">    </span><span class="c">%[P,L,G] = care(A,B,Q);</span>
<a href="#__codelineno-20-69" id="__codelineno-20-69" name="__codelineno-20-69"></a><span class="k">end</span>
</code></pre></div>
<h2 id="python-implementation">Python Implementation<a class="headerlink" href="#python-implementation" title="Permanent link">¶</a></h2>
<p>The Python implementation follows three main scenarios - </p>
<p>Scenario 1 is sharp braking at 20 seconds.</p>
<p>Scenario 2 is random distribution of vehicles and uniform distribution of initial velocity.</p>
<p>Scenario 3 is Experiment B of "Controllability Analysis and Optimal Control of Mixed Traffic Flow with Human-driven and Autonomous Vehicles".</p>
<p>The implementation follows the MATLAB version closely, utilizing NumPy instead of MATLAB methods where appropriate. </p>
<h4 id="functions_1">Functions<a class="headerlink" href="#functions_1" title="Permanent link">¶</a></h4>
<p>There are two main functions in the Python implementation :</p>
<ol>
<li>lqr_sdp
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">W</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">((</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">),</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>    <span class="c1">#                W[0:m,0:m] == Y,</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a>    <span class="c1">#                W[m:,0:m] == Z,</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a>    <span class="c1">#                W[m:,m:] == X,</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a>    <span class="n">objective</span>    <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span> <span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span> <span class="n">Q</span><span class="nd">@W</span><span class="p">[</span><span class="n">m</span><span class="p">:,</span><span class="n">m</span><span class="p">:]</span> <span class="p">)</span> <span class="o">+</span> <span class="n">cp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span> <span class="n">R</span><span class="nd">@W</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a>    <span class="n">constraints</span>  <span class="o">=</span> <span class="p">[(</span><span class="n">A</span><span class="nd">@W</span><span class="p">[</span><span class="n">m</span><span class="p">:,</span><span class="n">m</span><span class="p">:]</span> <span class="o">-</span> <span class="n">B</span><span class="nd">@W</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">:])</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span><span class="nd">@W</span><span class="p">[</span><span class="n">m</span><span class="p">:,</span><span class="n">m</span><span class="p">:]</span> <span class="o">-</span> <span class="n">B</span><span class="nd">@W</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">:])</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">H</span><span class="o">@</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">]</span>
<a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a>    <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">W</span><span class="p">[</span><span class="n">m</span><span class="p">:,</span><span class="n">m</span><span class="p">:]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a>    <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span><span class="n">W</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div>
This code sets up our optimization problem, generating a</li>
</ol>
<h2 id="experiment-results">Experiment Results<a class="headerlink" href="#experiment-results" title="Permanent link">¶</a></h2>
<h3 id="animation">Animation<a class="headerlink" href="#animation" title="Permanent link">¶</a></h3>
<p>Two demonstrations are shown below:    </p>
<p>All the vehicles are HDVs: traffic wave emerges
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/smoothing_traffic_flow_one_AV.gif"><img alt="Alt Text" src="../images/smoothing_traffic_flow/smoothing_traffic_flow_one_AV.gif"/></a></p>
<p>There is one AV: dissipating traffic wave
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/smoothing_traffic_flow_all_HDVs.gif"><img alt="Alt Text" src="../images/smoothing_traffic_flow/smoothing_traffic_flow_all_HDVs.gif"/></a></p>
<h3 id="control-energy-results">Control Energy Results<a class="headerlink" href="#control-energy-results" title="Permanent link">¶</a></h3>
<p>Simulation results after ran 2000 random simulations for different number of cars. </p>
<ul>
<li>(a) the control energy needed to stabilize the traffic flow for each autonomous vehicle.</li>
<li>(b) The time required to stabilize the traffic system. </li>
</ul>
<p>It is clear that both the settling time and the control energy of each autonomous vehicle decrease by a factor of two approximately, when there are two autonomous vehicles in the traffic system uniformly. Based on the results, we may estimate the market penetration rate of autonomous vehicles to control traffic flow effectively when adopting the optimal control strategy. In the scenario of the following figure, if one wants to reject the influence of the perturbation on traffic flow within 30 seconds, a single autonomous vehicle can control the traffic flow consisting of around 20 HDVs. This number agrees with the results from real-world experiments</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/control_energy.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/control_energy.png"/></a></p>
<h3 id="velocity-numerical-results">Velocity Numerical Results<a class="headerlink" href="#velocity-numerical-results" title="Permanent link">¶</a></h3>
<p>This is the numerical results for the scenario with a rapid and strong perturbation in the 6th vehicle. </p>
<ul>
<li>(a) Human driven vehicle only</li>
<li>(b) Mixed traffic system has an autonomous vehicle that adopts the optimal control strategy. </li>
</ul>
<p>The red color in the right figure means the velocity of vehicles slow down, and color yellow and white means fast. Here it is obvious that in scenario (a) there are more red which means slower than scenario (b).</p>
<p>We observe that if all the vehicles are human-driven, the perturbation may grow stronger during the propagation process (Figure a), while the autonomous vehicle with an optimal control strategy can respond actively to attenuate the perturbation and stabilize the traffic flow (Figure b). Here we only show the case where the 6th vehicle is under the strong perturbation. Indeed, the experiment results confirm that our strategy allows one autonomous vehicle to dampen strong traffic waves wherever they come from.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/velocity_result.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/velocity_result.png"/></a></p>
<h3 id="maximum-spacing-results">Maximum Spacing Results<a class="headerlink" href="#maximum-spacing-results" title="Permanent link">¶</a></h3>
<p>The comparison of three different strategies of maximum spacing of autonomous vehicle are shown below.</p>
<p>It is obvious that the maximum spacing in PI with Saturation, and Follower stopper is larger than Optimal control strategy. This means that the velocity of traffic applying PI and Follower Stopper strategies are much slower than using our optimal control strategy. </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/maximum_spacing_results.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/maximum_spacing_results.png"/></a></p>
<h3 id="fuel-consumption-results">Fuel Consumption Results<a class="headerlink" href="#fuel-consumption-results" title="Permanent link">¶</a></h3>
<p>The comparison on fuel consumption of three different strategies is shown as following. </p>
<p>It is observed that our proposed strategy achieves evidently lower fuel consumption than Fol- lowerStopper and PI with Saturation when the perturbation happens within the range from the 1st to the 10th vehicle. This result validates the great potential of our strategy in improving fuel economy. We note that, when the perturbation happens within the range from the 11th to the 20th vehicle, which is ahead of the autonomous vehicle in a small distance, all of the three strategies require the autonomous vehicle to brake hard to guarantee safety. In these cases, the three control strategies have similar performance in terms of fuel consumption.</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="100%" href="../images/smoothing_traffic_flow/fuel_consumption_results.png"><img alt="Alt Text" src="../images/smoothing_traffic_flow/fuel_consumption_results.png"/></a></p>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">¶</a></h2>
<ul>
<li>Zheng, Y., Wang, J., &amp; Li, K. (2020). Smoothing traffic flow via control of autonomous vehicles. <em>IEEE Internet of Things Journal</em>, <em>7</em>(5), 3882-3896.[<a href="https://wangjw18.github.io/files/2018-arXiv.pdf">pdf</a>]</li>
</ul>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2022 SOC Lab
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.tracking", "navigation.indexes", "toc.integrate", "toc.follow", "navigation.expand"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.51198bba.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>